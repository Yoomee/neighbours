<%if @post.valid? && params[:return_to].present?%>
  window.location.href = '<%=params[:return_to]%>';
<%elsif @post.target_type == "Need" && @post.context != 'chat'%>
  <%=remotipart_response do%>
    <%post = (@new_post || @post)%>
    $('form#new_post').replaceWith('<%=escape_javascript(render('needs/modal_post_form', :post => post, :need => post.target))%>');
  <%end%>
<%else%>
  <%=remotipart_response do%>
    <%if @post.valid?%>
      $('.need-posts').prepend('<%=escape_javascript(render('needs/post', :post => @post))%>');
    <%end%>
    $('form#new_post').remove()
    $('.need-posts').prepend('<%=escape_javascript(render('remote_form', :post => (@new_post || @post)))%>');
  <%end%>
<%end%>